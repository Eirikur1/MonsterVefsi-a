name: Development Workflow

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Validate and Test
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Validate HTML structure
      run: |
        echo "ğŸ” Validating HTML structure..."
        
        # Check for required HTML elements
        if ! grep -q "<!doctype html>" index.html; then
          echo "âŒ Missing DOCTYPE declaration"
          exit 1
        fi
        
        if ! grep -q '<html lang="en">' index.html; then
          echo "âŒ Missing HTML lang attribute"
          exit 1
        fi
        
        if ! grep -q '<head>' index.html; then
          echo "âŒ Missing head section"
          exit 1
        fi
        
        if ! grep -q '<body>' index.html; then
          echo "âŒ Missing body section"
          exit 1
        fi
        
        echo "âœ… HTML structure validation passed"
        
    - name: Check meta tags
      run: |
        echo "ğŸ” Checking meta tags..."
        
        # Check for essential meta tags
        if ! grep -q '<meta charset="utf-8"' index.html; then
          echo "âŒ Missing UTF-8 charset"
          exit 1
        fi
        
        if ! grep -q '<meta name="viewport"' index.html; then
          echo "âŒ Missing viewport meta tag"
          exit 1
        fi
        
        if ! grep -q '<title>' index.html; then
          echo "âŒ Missing title tag"
          exit 1
        fi
        
        echo "âœ… Meta tags validation passed"
        
    - name: Check accessibility
      run: |
        echo "ğŸ” Checking accessibility features..."
        
        # Check for alt attributes on images
        if grep -q '<img' index.html && ! grep -q 'alt=' index.html; then
          echo "âš ï¸  Images found without alt attributes"
        fi
        
        # Check for semantic HTML elements
        if grep -q '<main>' index.html; then
          echo "âœ… Main element found"
        fi
        
        if grep -q '<header>' index.html; then
          echo "âœ… Header element found"
        fi
        
        if grep -q '<nav>' index.html; then
          echo "âœ… Navigation element found"
        fi
        
        echo "âœ… Accessibility check completed"
        
    - name: Check responsive design
      run: |
        echo "ğŸ” Checking responsive design elements..."
        
        # Check for viewport meta tag
        if grep -q 'width=device-width' index.html; then
          echo "âœ… Responsive viewport configured"
        else
          echo "âŒ Responsive viewport not configured"
          exit 1
        fi
        
        # Check for media queries in CSS
        if grep -q '@media' index.html; then
          echo "âœ… Media queries found"
        else
          echo "âš ï¸  No media queries found (may not be responsive)"
        fi
        
        echo "âœ… Responsive design check completed"
        
    - name: Performance check
      run: |
        echo "ğŸ” Checking performance optimizations..."
        
        # Check for external resources
        if grep -q 'https://fonts.googleapis.com' index.html; then
          echo "âœ… Google Fonts loaded"
        fi
        
        # Check for inline CSS (good for performance)
        if grep -q '<style>' index.html; then
          echo "âœ… CSS is inline (good for performance)"
        fi
        
        echo "âœ… Performance check completed"
        
    - name: Run tests
      run: |
        echo "ğŸ§ª Running tests..."
        npm test
        echo "âœ… Tests completed"
        
    - name: Build check
      run: |
        echo "ğŸ”¨ Checking build process..."
        npm run build
        echo "âœ… Build check completed"
        
    - name: Success message
      run: |
        echo "ğŸ‰ All validations passed!"
        echo "âœ… HTML structure is valid"
        echo "âœ… Meta tags are properly configured"
        echo "âœ… Accessibility features are in place"
        echo "âœ… Responsive design is implemented"
        echo "âœ… Performance optimizations are applied"
